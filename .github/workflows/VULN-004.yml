name: VULN-004 - Input Validation Check
on:
  workflow_dispatch:

jobs:
  validation-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check input validation
        run: |
          echo "ðŸ” Revisando validaciÃ³n de entradas..."
          
          # Buscar DTOs y modelos
          echo "=== Modelos y DTOs ==="
          find . -name "*.cs" -type f | xargs grep -l "class.*Dto\|class.*Model" | grep -v "Test" | head -10
          
          # Verificar atributos de validaciÃ³n
          echo "=== Atributos de validaciÃ³n ==="
          if find . -name "*.cs" -type f | xargs grep -l "Required\|StringLength\|Range\|Validation" | head -10; then
            echo "âœ… Se encontraron validaciones"
          else
            echo "âš ï¸ Pocas validaciones encontradas"
          fi
          
          # Contar validaciones vs modelos
          echo "=== EstadÃ­sticas de validaciÃ³n ==="
          MODEL_COUNT=$(find . -name "*.cs" -type f | xargs grep -l "class.*Dto\|class.*Model" | grep -v "Test" | wc -l)
          VALIDATION_COUNT=$(find . -name "*.cs" -type f | xargs grep -c "Required\|StringLength\|Range" | awk -F: '{sum+=$2} END {print sum}')
          echo "Modelos encontrados: $MODEL_COUNT"
          echo "Validaciones encontradas: $VALIDATION_COUNT"

      - name: Generate validation report
        run: |
          cat > vuln-004-report.md << 'EOF'
          # VULN-004 - Input Validation Report
          
          ## Hallazgos
          - RevisiÃ³n de modelos y DTOs
          - Conteo de atributos de validaciÃ³n
          - AnÃ¡lisis de cobertura de validaciÃ³n
          
          ## Recomendaciones
          1. Agregar [Required] a campos obligatorios
          2. Usar [StringLength] para campos de texto
          3. Implementar [Range] para valores numÃ©ricos
          4. Validar todos los DTOs de entrada
          
          **Estado**: AnÃ¡lisis bÃ¡sico completado
          EOF

      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: vuln-004-validation
          path: vuln-004-report.md
