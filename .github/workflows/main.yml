name: VULN-005 - Swagger Security Check
on:
  workflow_dispatch:

jobs:
  swagger-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check Swagger configuration
        run: |
          echo "ðŸ” Revisando configuraciÃ³n de Swagger..."
          
          # Buscar configuraciÃ³n de Swagger
          echo "=== ConfiguraciÃ³n de Swagger ==="
          find . -name "*.cs" -type f | xargs grep -l "AddSwaggerGen\|Swashbuckle" | head -5
          
          # Verificar entorno de Swagger
          echo "=== Restricciones por entorno ==="
          if find . -name "*.cs" -type f | xargs grep -B5 -A5 "AddSwaggerGen" | grep -E "IsDevelopment\|Environment.Development" | head -5; then
            echo "âœ… Swagger parece restringido a desarrollo"
          else
            echo "âš ï¸ Swagger puede estar habilitado en producciÃ³n"
          fi
          
          # Verificar autenticaciÃ³n en Swagger
          echo "=== AutenticaciÃ³n en Swagger ==="
          if find . -name "*.cs" -type f | xargs grep -B5 -A5 "AddSwaggerGen" | grep -E "AddSecurityDefinition\|Authorization" | head -5; then
            echo "âœ… Swagger tiene configuraciÃ³n de seguridad"
          else
            echo "âš ï¸ Swagger no tiene autenticaciÃ³n configurada"
          fi

      - name: Generate swagger report
        run: |
          cat > vuln-005-report.md << 'EOF'
          # VULN-005 - Swagger Security Report
          
          ## Hallazgos
          - RevisiÃ³n de configuraciÃ³n de Swagger
          - VerificaciÃ³n de restricciones por entorno
          - AnÃ¡lisis de autenticaciÃ³n en Swagger UI
          
          ## Recomendaciones
          1. Restringir Swagger solo a entorno de desarrollo
          2. Implementar autenticaciÃ³n bÃ¡sica para Swagger
          3. Deshabilitar Swagger en producciÃ³n
          
          **Estado**: RevisiÃ³n bÃ¡sica completada
          EOF

      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: vuln-005-swagger
          path: vuln-005-report.md
