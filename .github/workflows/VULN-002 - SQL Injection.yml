name: VULN-002 - SQL Injection Scan
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  scan-sql-injection:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Scan for SQL injection patterns
        run: |
          echo "üîç Scanning for SQL injection vulnerabilities..."
          
          # Buscar patrones espec√≠ficos de concatenaci√≥n SQL
          PATTERNS_FOUND=false
          
          # Buscar concatenaci√≥n en consultas SQL
          if grep -r "SqlCommand.*\\+" --include="*.cs" . || \
             grep -r "string.*sql.*\\+" --include="*.cs" . || \
             grep -r "ExecuteSqlRaw.*\\+" --include="*.cs" . || \
             grep -r "FromSqlRaw.*\\+" --include="*.cs" .; then
            echo "‚ùå VULN-002: Potential SQL injection patterns found"
            PATTERNS_FOUND=true
          fi
          
          if [ "$PATTERNS_FOUND" = true ]; then
            echo "üìã Evidencia: Concatenaci√≥n de strings en consultas SQL detectada"
            echo "üí° Recomendaci√≥n: Usar par√°metros SQL o Entity Framework con LINQ"
            exit 1
          else
            echo "‚úÖ VULN-002: No SQL injection patterns found"
          fi
