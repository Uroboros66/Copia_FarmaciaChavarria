name: VULN-001 - Hardcoded JWT Secret
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  scan-jwt-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Scan for hardcoded JWT secrets
        run: |
          echo "ğŸ” Scanning for hardcoded JWT secrets..."
          
          # Buscar claves JWT hardcodeadas
          if find . -name "appsettings*.json" -exec grep -l '"Key":' {} \; | grep -q .; then
            echo "âŒ VULN-001: Hardcoded JWT secrets found in:"
            find . -name "appsettings*.json" -exec grep -l '"Key":' {} \;
            echo "ğŸ“‹ Evidencia:"
            find . -name "appsettings*.json" -exec grep -A 2 '"Key":' {} \;
            echo "ğŸ’¡ RecomendaciÃ³n: Usar Azure Key Vault o GitHub Secrets"
            exit 1
          else
            echo "âœ… VULN-001: No hardcoded JWT secrets found"
          fi
